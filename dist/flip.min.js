!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.flip=t()}(this,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function n(t){e(this,n),this.element=t}return t(n,[{key:"getStyle",value:function(e){return window.getComputedStyle(this.element).getPropertyValue(e)}},{key:"getStyles",value:function(e){var t=this;return e.map(function(e){return t.getStyle(t.element,e)})}},{key:"setStyle",value:function(e,t){var n;this.element.style[(n=e,n.replace(/(-\w)/g,function(e){return e[1].toUpperCase()}))]=t}},{key:"addClass",value:function(e){this.element.classList.add(e)}},{key:"addEventListener",value:function(e,t){this.element.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.element.removeEventListener(e,t)}},{key:"measure",value:function(e){return{rect:this.element.getBoundingClientRect(),opacity:this.getStyle("opacity"),others:this.getStyles(e)}}}],[{key:"getTransition",value:function(e,t,n){return e.map(function(e){return e+" "+t+" "+n}).join(",")}},{key:"getTransform",value:function(e,t,n,r){var i=[];return(e||t)&&i.push("translate("+e+"px,"+t+"px)"),1===n&&1===r||i.push("scale("+n+","+r+")"),i.join(" ")}}]),n}(),r=function(){function r(t,i,o){e(this,r),this.helper=new n(t),this.toClass=i,this.otherPropsToFlip=o?[].concat(o):[]}return t(r,[{key:"firstLastInvert",value:function(){var e=this.helper.measure(this.otherPropsToFlip);this.helper.addClass(this.toClass);var t=this.helper.measure(this.otherPropsToFlip);this.inverted=this.invert(e,t,this.otherPropsToFlip)}},{key:"play",value:function(e,t){var i=this;return new Promise(function(o){var s=[];if(i.inverted.hasTransformChanged&&s.push("transform"),i.inverted.hasOpacityChanged&&s.push("opacity"),r.forEachPropThatChanged(i.otherPropsToFlip,i.inverted,function(e){return s.push(e)}),s.length){i.helper.setStyle("transition",n.getTransition(s,e,t));i.helper.addEventListener("transitionend",function e(){i.helper.removeEventListener("transitionend",e),i.helper.setStyle("transition",""),o()}),i.inverted.hasTransformChanged&&i.helper.setStyle("transform",""),i.inverted.hasOpacityChanged&&i.helper.setStyle("opacity",""),r.forEachPropThatChanged(i.otherPropsToFlip,i.inverted,function(e){return i.helper.setStyle(e,"")})}else o()})}},{key:"invert",value:function(e,t,i){var o=this,s={translateX:(e.rect.left+e.rect.right)/((2-(t.rect.left+t.rect.right))/2),translateY:(e.rect.top+e.rect.bottom)/((2-(t.rect.top+t.rect.bottom))/2),scaleX:e.rect.width/t.rect.width,scaleY:e.rect.height/t.rect.height,hasOpacityChanged:e.opacity!==t.opacity,opacity:e.opacity,hasOtherPropsToFlipChanged:e.others.map(function(e,n){return e!==t.others[n]}),otherPropsToFlip:e.others};return s.transform=n.getTransform(s.translateX,s.translateY,s.scaleX,s.scaleY),s.hasTransformChanged=!!s.transform,s.hasTransformChanged&&this.helper.setStyle("transform",s.transform),s.hasOpacityChanged&&this.helper.setStyle("opacity",s.opacity),r.forEachPropThatChanged(i,s,function(e,t){return o.helper.setStyle(e,s.otherPropsToFlip[t])}),s}}],[{key:"equals",value:function(e,t){return e.helper.element===t.helper.element&&e.toClass===t.toClass}},{key:"forEachPropThatChanged",value:function(e,t,n){e.forEach(function(e,r){t.hasOtherPropsToFlipChanged[r]&&n(e,r)})}}]),r}();return function(){function n(){e(this,n),this.reset()}return t(n,[{key:"withTransition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"375ms",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cubic-bezier(0.4, 0.0, 0.2, 1)";return this.transitionDuration=e||this.transitionDuration,this.transitionTimingFunction=t||this.transitionTimingFunction,this}},{key:"withClass",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e)throw new Error("elements should be defined");if(!t)throw new Error("toClass should be defined");this.ongoing&&console.warn("withClass(): transition already ongoing");var o=void 0;return[].concat(e).forEach(function(e){o=new r(e,t,i),n.flippers.some(function(e){return r.equals(e,o)})||n.flippers.push(o)}),this}},{key:"go",value:function(){var e=this;return new Promise(function(t){var n;e.ongoing=!0,e.flippers.forEach(function(e){return e.firstLastInvert()}),n=function(){var n=e.flippers.map(function(t){return t.play(e.transitionDuration,e.transitionTimingFunction)});Promise.all(n).then(function(){e.ongoing=!1,e.reset(),t()})},requestAnimationFrame(function(){return requestAnimationFrame(n)})})}},{key:"reset",value:function(){return this.ongoing&&console.warn("reset(): transition still ongoing"),this.flippers=[],this.withTransition(),this}}]),n}()});
