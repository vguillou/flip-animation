{"version":3,"file":"flip.umd.js","sources":["../src/flip.js"],"sourcesContent":["class Utils {\n  static snakeToCamel(str) {\n    return str.replace(/(-\\w)/g, (match) => match[1].toUpperCase());\n  }\n\n  static nextFrame(fn) {\n    // Twice because of firefox\n    requestAnimationFrame(() => requestAnimationFrame(fn));\n  }\n}\n\nclass ElementHelper {\n  constructor(element) {\n    this.element = element;\n  }\n\n  cleanTransition() {\n    this.element.style.transition = '';\n  }\n\n  setStyle(styleProp, value) {\n    this.element.style[Utils.snakeToCamel(styleProp)] = value;\n  }\n\n  static getStyle(element, styleProp) {\n    return window.getComputedStyle(element).getPropertyValue(styleProp);\n  }\n\n  static getStyles(element, styleProps) {\n    return styleProps.map((prop) => this.getStyle(element, prop));\n  }\n\n  static measure(element, otherPropsToFlip) {\n    return {\n      rect: element.getBoundingClientRect(),\n      opacity: ElementHelper.getStyle(element, 'opacity'),\n      others: ElementHelper.getStyles(element, otherPropsToFlip),\n    };\n  }\n\n  static getTransition(properties, transitionDuration, transitionTimingFunction) {\n    return properties\n      .map((prop) => `${prop} ${transitionDuration} ${transitionTimingFunction}`)\n      .join(',');\n  }\n}\n\nclass Flipper {\n  constructor(element, toClass, otherPropsToFlip) {\n    this.element = element;\n    this.helper = new ElementHelper(element);\n    this.toClass = toClass;\n    this.otherPropsToFlip = otherPropsToFlip ? [].concat(otherPropsToFlip) : [];\n  }\n\n  firstLastInvert() {\n    // first\n    const first = ElementHelper.measure(this.element, this.otherPropsToFlip);\n\n    this.element.classList.add(this.toClass);\n\n    // last\n    const last = ElementHelper.measure(this.element, this.otherPropsToFlip);\n\n    // invert\n    this.invert = this.invert(first, last, this.otherPropsToFlip);\n  }\n\n  play(transitionDuration, transitionTimingFunction) {\n    // Switch on animations.\n    const transitionProps = ['transform'];\n    if (this.invert.hasOpacityChanged) transitionProps.push('opacity');\n    Flipper.forEachPropThatChanged(this.otherPropsToFlip, this.invert, (prop) =>\n      transitionProps.push(prop),\n    );\n\n    this.element.style.transition = ElementHelper.getTransition(\n      transitionProps,\n      transitionDuration,\n      transitionTimingFunction,\n    );\n\n    // Remove transform and opacity to trigger the transition towards the css class\n    this.element.style.transform = '';\n    if (this.invert.hasOpacityChanged) this.element.style.opacity = '';\n    Flipper.forEachPropThatChanged(this.otherPropsToFlip, this.invert, (prop) =>\n      this.helper.setStyle(prop, ''),\n    );\n  }\n\n  cleanTransition() {\n    this.helper.cleanTransition();\n  }\n\n  invert(first, last, otherPropsToFlip) {\n    const invert = {\n      translateX: (first.rect.left + first.rect.right) / 2 - (last.rect.left + last.rect.right) / 2,\n      translateY: (first.rect.top + first.rect.bottom) / 2 - (last.rect.top + last.rect.bottom) / 2,\n      scaleX: first.rect.width / last.rect.width,\n      scaleY: first.rect.height / last.rect.height,\n      hasOpacityChanged: first.opacity !== last.opacity,\n      opacity: first.opacity,\n      hasOtherPropsToFlipChanged: first.others.map(\n        (firstOther, index) => firstOther !== last.others[index],\n      ),\n      otherPropsToFlip: first.others,\n    };\n\n    // Invert\n    this.element.style.transform = `translate(${invert.translateX}px,${\n      invert.translateY\n    }px) scale(${invert.scaleX},${invert.scaleY})`;\n    if (invert.hasOpacityChanged) this.element.style.opacity = invert.opacity;\n    Flipper.forEachPropThatChanged(otherPropsToFlip, invert, (prop, index) =>\n      this.helper.setStyle(this.element, prop, invert.otherPropsToFlip[index]),\n    );\n\n    // return info about what has changed\n    return invert;\n  }\n\n  static forEachPropThatChanged(props, invert, actionFn) {\n    props.forEach((p, index) => {\n      if (invert.hasOtherPropsToFlipChanged[index]) actionFn(p, index);\n    });\n  }\n\n  static transitionEndCallback(flipper, resolve) {\n    return () => {\n      flipper.element.removeEventListener('transitionend', Flipper.transitionEndCallback);\n      flipper.cleanTransition();\n      if (resolve) resolve();\n    };\n  }\n}\n\nclass Flip {\n  constructor() {\n    this.flippers = [];\n    this.withTransition();\n  }\n\n  /**\n   * Set the properties of the transition\n   * @param {String} duration as set in CSS (default is '375ms')\n   * @param {String} timingFunction as set in CSS (default is 'cubic-bezier(0.4, 0.0, 0.2, 1)')\n   * @returns the instance of Flip\n   */\n  withTransition(duration = '375ms', timingFunction = 'cubic-bezier(0.4, 0.0, 0.2, 1)') {\n    this.transitionDuration = duration || this.transitionDuration;\n    this.transitionTimingFunction = timingFunction || this.transitionTimingFunction;\n    return this;\n  }\n\n  /**\n   * Set the element that will transition, and the CSS to which it will transition to.\n   * @param {HTMLElement} element that will transition\n   * @param {String}} toClass CSS class to which the element will transition to\n   * @param {Array or String} otherPropsToFlip Optionnaly, the additionnal CSS properties\n   * that should transition (other than 'opacity' and 'transform', in snake case)\n   * @returns the instance of Flip\n   * @throws {Error} if either 'element' or 'toClass' in not defined\n   */\n  withClass(element, toClass, otherPropsToFlip = []) {\n    if (!element) throw new Error('element should be defined');\n    if (!toClass) throw new Error('toClass should be defined');\n    this.flippers.push(new Flipper(element, toClass, otherPropsToFlip));\n    return this;\n  }\n\n  /**\n   * Triggers the transition.\n   * @returns A Promise that resolves after the transition ended.\n   */\n  go() {\n    return new Promise((resolve) => {\n      // fli\n      this.flippers.forEach((flipper) => flipper.firstLastInvert());\n      // p\n      Utils.nextFrame(() => {\n        this.flippers.forEach((flipper, index) => {\n          flipper.element.addEventListener(\n            'transitionend',\n            Flipper.transitionEndCallback(flipper, !index ? resolve : undefined),\n          );\n          flipper.play(this.transitionDuration, this.transitionTimingFunction);\n        });\n      });\n      if (!this.flippers.length) resolve();\n    });\n  }\n}\n\nexport default Flip;\n"],"names":["Utils","snakeToCamel","str","replace","match","toUpperCase","nextFrame","fn","requestAnimationFrame","ElementHelper","constructor","element","cleanTransition","style","transition","setStyle","styleProp","value","getStyle","window","getComputedStyle","getPropertyValue","getStyles","styleProps","map","prop","measure","otherPropsToFlip","rect","getBoundingClientRect","opacity","others","getTransition","properties","transitionDuration","transitionTimingFunction","join","Flipper","toClass","helper","concat","firstLastInvert","first","classList","add","last","invert","play","transitionProps","hasOpacityChanged","push","forEachPropThatChanged","transform","translateX","left","right","translateY","top","bottom","scaleX","width","scaleY","height","hasOtherPropsToFlipChanged","firstOther","index","props","actionFn","forEach","p","transitionEndCallback","flipper","resolve","removeEventListener","Flip","flippers","withTransition","duration","timingFunction","withClass","Error","go","Promise","addEventListener","undefined","length"],"mappings":"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"}